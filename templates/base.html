<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{% block title %}Sistema de Fila{% endblock %}</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #0d0d0f;
  --surface: #141416;
  --surface2: #18181c;
  --border: #1e1e22;
  --border2: #27272e;
  --accent: #4ade80;
  --accent-dim: #4ade8018;
  --accent-glow: #4ade8040;
  --warn: #facc15;
  --warn-dim: #facc1518;
  --info: #60a5fa;
  --info-dim: #60a5fa18;
  --danger: #f87171;
  --danger-dim: #f8717118;
  --text: #e8e8ea;
  --muted: #5a5a64;
  --muted2: #2e2e36;
}

html, body {
  min-height: 100vh;
  background: var(--bg);
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  font-size: 14px;
}

/* ── HEADER ── */
.app-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.7rem 1.25rem;
  border-bottom: 1px solid var(--border);
  background: var(--surface);
}

.hdr-logo { display: flex; align-items: center; gap: 0.5rem; }

.hdr-dot {
  width: 9px; height: 9px;
  border-radius: 50%;
  background: var(--accent);
  box-shadow: 0 0 8px #4ade8077;
}

.hdr-title {
  font-family: 'DM Mono', monospace;
  font-size: 0.75rem;
  letter-spacing: 0.1em;
  color: var(--muted);
}

.hdr-right { display: flex; align-items: center; gap: 0.75rem; }
.hdr-user { font-size: 0.78rem; color: var(--muted); }

.btn-ghost {
  font-family: 'DM Mono', monospace;
  font-size: 0.65rem;
  letter-spacing: 0.05em;
  padding: 0.3rem 0.65rem;
  background: transparent;
  border: 1px solid var(--border);
  color: var(--muted);
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.18s;
  text-decoration: none;
  display: inline-block;
}
.btn-ghost:hover { border-color: var(--danger); color: var(--danger); }

.admin-badge {
  font-family: 'DM Mono', monospace;
  font-size: 0.6rem;
  letter-spacing: 0.08em;
  padding: 0.18rem 0.45rem;
  background: var(--info-dim);
  color: var(--info);
  border-radius: 4px;
}

.app-main {
  max-width: 560px;
  margin: 0 auto;
  padding: 1.5rem 1rem;
}

/* ── FLASH MESSAGES ── */
.flash-messages {
  max-width: 560px;
  margin: 1rem auto 0;
  padding: 0 1rem;
}

.flash-msg {
  padding: 0.75rem 1rem;
  background: var(--danger-dim);
  border: 1px solid #f8717140;
  border-left: 3px solid var(--danger);
  border-radius: 8px;
  margin-bottom: 0.75rem;
  font-size: 0.82rem;
  animation: slide-in 0.3s ease;
}

.flash-msg.success {
  background: var(--accent-dim);
  border-color: #4ade8040;
  border-left-color: var(--accent);
  color: var(--accent);
}

@keyframes slide-in {
  from { transform: translateY(-10px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

/* ── BUTTONS ── */
.btn-primary {
  width: 100%;
  padding: 0.7rem;
  background: var(--accent);
  color: #0d0d0f;
  font-family: 'DM Mono', monospace;
  font-size: 0.82rem;
  font-weight: 500;
  letter-spacing: 0.05em;
  border: none;
  border-radius: 7px;
  cursor: pointer;
  transition: all 0.18s;
}
.btn-primary:hover { opacity: 0.88; box-shadow: 0 0 18px var(--accent-glow); }
.btn-primary:active { transform: scale(0.98); }

.btn-green {
  flex: 1;
  padding: 0.6rem;
  background: var(--accent);
  color: #0d0d0f;
  font-family: 'DM Mono', monospace;
  font-size: 0.72rem;
  letter-spacing: 0.06em;
  border: none;
  border-radius: 7px;
  cursor: pointer;
  transition: all 0.18s;
}
.btn-green:hover { opacity: 0.88; box-shadow: 0 0 14px var(--accent-glow); }

.btn-skip {
  flex: 1;
  padding: 0.6rem;
  background: transparent;
  border: 1px solid var(--border);
  color: var(--muted);
  font-family: 'DM Mono', monospace;
  font-size: 0.72rem;
  letter-spacing: 0.06em;
  border-radius: 7px;
  cursor: pointer;
  transition: all 0.18s;
}
.btn-skip:hover { border-color: var(--warn); color: var(--warn); }

.btn-yellow {
  padding: 0.6rem 1.2rem;
  background: var(--warn);
  color: #0d0d0f;
  font-family: 'DM Mono', monospace;
  font-size: 0.72rem;
  letter-spacing: 0.06em;
  border: none;
  border-radius: 7px;
  cursor: pointer;
  transition: all 0.18s;
}
.btn-yellow:hover { opacity: 0.88; }

.btn-danger {
  padding: 0.6rem 1.2rem;
  background: var(--danger);
  color: #fff;
  font-family: 'DM Mono', monospace;
  font-size: 0.72rem;
  letter-spacing: 0.06em;
  border: none;
  border-radius: 7px;
  cursor: pointer;
  transition: all 0.18s;
}
.btn-danger:hover { opacity: 0.88; }

/* ── CARDS ── */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 1rem 1.1rem;
}

.vez-card {
  background: var(--accent-dim);
  border: 1px solid #4ade8030;
  border-radius: 10px;
  padding: 1.25rem 1.5rem;
  margin-bottom: 1.5rem;
  animation: glow-pulse 2.5s ease-in-out infinite;
}

@keyframes glow-pulse {
  0%,100% { box-shadow: 0 0 0 0 #4ade8010; }
  50% { box-shadow: 0 0 0 8px #4ade8006; }
}

.card-chip {
  font-family: 'DM Mono', monospace;
  font-size: 0.62rem;
  letter-spacing: 0.12em;
  margin-bottom: 0.35rem;
}

.chip-green { color: var(--accent); }
.chip-yellow { color: var(--warn); }
.chip-blue { color: var(--info); }

.card-name { font-size: 1.05rem; font-weight: 500; }
.card-sub { font-size: 0.76rem; color: var(--muted); margin-top: 0.15rem; }

.btn-row {
  display: flex;
  gap: 0.6rem;
  margin-top: 1rem;
}

.aguard-card {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 1.1rem 1.5rem;
  margin-bottom: 1.5rem;
}

.pos-num {
  font-family: 'DM Mono', monospace;
  font-size: 1.8rem;
  font-weight: 300;
}

.pos-num small {
  display: block;
  font-size: 0.65rem;
  color: var(--muted);
  text-align: right;
  margin-top: 2px;
}

.analis-card {
  background: var(--warn-dim);
  border: 1px solid #facc1530;
  border-radius: 10px;
  padding: 1.25rem 1.5rem;
  margin-bottom: 1.5rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
}

.fora-card {
  background: var(--surface);
  border: 1px dashed var(--border);
  border-radius: 10px;
  padding: 2rem;
  text-align: center;
  margin-bottom: 1.5rem;
}

.fora-card p { font-size: 0.8rem; color: var(--muted); margin-bottom: 1rem; }

.btn-entrar {
  padding: 0.65rem 1.75rem;
  background: var(--accent);
  color: #0d0d0f;
  font-family: 'DM Mono', monospace;
  font-size: 0.78rem;
  letter-spacing: 0.07em;
  border: none;
  border-radius: 7px;
  cursor: pointer;
  transition: all 0.18s;
}
.btn-entrar:hover { box-shadow: 0 0 18px var(--accent-glow); opacity: 0.9; }

.btn-sair-fila {
  font-family: 'DM Mono', monospace;
  font-size: 0.68rem;
  padding: 0.4rem 0.9rem;
  background: transparent;
  border: 1px solid var(--border);
  color: var(--muted);
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.18s;
  margin-top: 0.5rem;
  display: block;
  margin: 0.5rem auto 1.5rem;
}
.btn-sair-fila:hover { border-color: var(--danger); color: var(--danger); }

/* ── SECTION TITLE ── */
.sec-title {
  font-family: 'DM Mono', monospace;
  font-size: 0.6rem;
  letter-spacing: 0.12em;
  color: var(--muted);
  text-transform: uppercase;
  margin-bottom: 0.7rem;
}

/* ── FILA LIST ── */
.fila-list { display: flex; flex-direction: column; gap: 0.35rem; }

.fila-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.6rem 0.9rem;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  transition: all 0.25s;
  animation: item-in 0.3s ease both;
}

@keyframes item-in {
  from { opacity: 0; transform: translateX(-8px); }
  to { opacity: 1; transform: translateX(0); }
}

.fila-item.vez { background: var(--accent-dim); border-color: #4ade8030; }
.fila-item.analisando { background: var(--warn-dim); border-color: #facc1528; }
.fila-item.eu { border-left: 2px solid var(--accent); }

.fila-pos {
  font-family: 'DM Mono', monospace;
  font-size: 0.68rem;
  color: var(--muted2);
  width: 18px;
  text-align: center;
  flex-shrink: 0;
}

.fila-info { flex: 1; }
.fila-nome { font-size: 0.85rem; font-weight: 500; }
.fila-status { font-size: 0.66rem; margin-top: 1px; color: var(--muted); }
.fila-status.green { color: var(--accent); }
.fila-status.yellow { color: var(--warn); }

.badge-eu {
  font-family: 'DM Mono', monospace;
  font-size: 0.58rem;
  padding: 0.12rem 0.4rem;
  background: var(--accent-dim);
  color: var(--accent);
  border-radius: 3px;
}

/* ── POPUP ── */
.popup {
  display: none;
  position: fixed;
  bottom: 1.25rem;
  right: 1.25rem;
  background: var(--surface);
  border: 1px solid #4ade8040;
  border-left: 3px solid var(--accent);
  border-radius: 10px;
  padding: 1rem 1.25rem;
  max-width: 260px;
  box-shadow: 0 8px 40px #00000077;
  z-index: 200;
  animation: slide-in 0.3s ease;
}

.popup.show { display: block; }
.popup-title { font-family: 'DM Mono', monospace; font-size: 0.62rem; letter-spacing: 0.1em; color: var(--accent); margin-bottom: 0.3rem; }
.popup-msg { font-size: 0.82rem; }
.popup-close { position: absolute; top: 0.5rem; right: 0.7rem; background: none; border: none; color: var(--muted); cursor: pointer; font-size: 1rem; }

{% block extra_styles %}{% endblock %}
</style>
</head>
<body>

{% if current_user.is_authenticated %}
<div class="app-header">
  <div class="hdr-logo">
    <div class="hdr-dot"></div>
    <span class="hdr-title">FILA</span>
    {% if current_user.is_admin %}
    <span class="admin-badge">ADMIN</span>
    {% endif %}
  </div>
  <div class="hdr-right">
    <span class="hdr-user">{{ current_user.username }}</span>
    <a href="{{ url_for('logout') }}" class="btn-ghost">SAIR</a>
  </div>
</div>
{% endif %}

{% with messages = get_flashed_messages() %}
  {% if messages %}
  <div class="flash-messages">
    {% for message in messages %}
      <div class="flash-msg">{{ message }}</div>
    {% endfor %}
  </div>
  {% endif %}
{% endwith %}

{% block content %}{% endblock %}

<audio id="notificationSound" src="/static/sounds/notification.mp3" preload="auto"></audio>

<script>
const socket = io();
socket.on('update_queue', () => {
    window.location.reload();
});
</script>
{% block scripts %}{% endblock %}
</body>
</html>
